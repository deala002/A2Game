<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>Meeting Timer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <script>

    class subTask {
      constructor(name, hours, minutes, seconds){
        this.name = name;
        this.hours = hours;
        this.minutes = minutes;
        this.seconds = seconds;
      }

      returnName() {
        return this.name;
      }

      returnHours() {
        return this.hours;
      }

      returnMinutes() {
        return this.minutes;
      }

      returnSeconds() {
        return this.seconds;
      }
    }

    var timerInterval = setInterval(null, 0);
    var savedTime = 0;
    var originalTime = 0;
    var currentTime = 0;
    var numSubTasks = 1;
    var currentTask = 0;
    var paused = false;
    const taskNames = [];
    const taskTimes = [];

    //Initate the start time of the timer
    function initiateCountdown() 
    {
        //Clear previously running timer
        clearInterval(timerInterval);

        //Get current time to set as reference point
        var startpoint = new Date().getTime();

      //Ignore values in textboxes if timer is paused
      if(paused == true)
      {
      paused = false;
      timerInterval = setInterval(function () { countDown(savedTime, startpoint) }, 100);
      }
      else {
        for(var i=0; i<numSubTasks; i++)
        {
          //Get time to set to from input
          var minutesInput = document.getElementById("taskTime" + i.toString(10));
          var taskInput = document.getElementById("taskName" + i.toString(10));

          taskTimes[i] = 0;

          if(i!=0)
          {
            taskTimes[i] = taskTimes[i-1];
          }

          taskNames[i] = taskInput.value;

          //Set time to 0 if none is specified
          if (minutesInput.value != "")
          taskTimes[i] += JSON.parse(minutesInput.value);
          }

          //Calculate total time based of hours minutes and seconds 
          var totalOffset = taskTimes[numSubTasks-1] * 60000;

        //Initate countdown function from specified time
        if (totalOffset > 0) {
          originalTime = totalOffset;
          savedTime = totalOffset;
          timerInterval = setInterval(function () { countDown(totalOffset, startpoint) }, 100);
        }
        else //Initiate countdown function from last set time if no time is specified
          timerInterval = setInterval(function () { countDown(savedTime, startpoint) }, 100);
        
          //Display first task name in textbox
          var taskText = document.getElementById('taskName');
          taskText.innerHTML = taskNames[0];
        }
    }

    //Pause the countdown at current point
    function pauseCountdown() 
    {
      clearInterval(timerInterval);
      savedTime = currentTime;
      paused = true;
    }

    //Reset the countdown back to the originally specified time
    function resetCountdown() {
      clearInterval(timerInterval);

      savedTime = originalTime;
      currentTask = 0;

      var startpoint = new Date().getTime();
      countDown(originalTime, startpoint);
    }

    // Update count down each second
    function countDown(offset, startpoint) {
      // Update date and time to reference against original time
      var now = new Date().getTime();

      // Find the distance between now and reference date, adding in offset to count down from
      var distance = ((startpoint + offset) - now);
      currentTime = distance;

      var elapsedTime = (originalTime/60000) - (currentTime/60000);

      if(elapsedTime > taskTimes[currentTask])
      {
        currentTask++;
        taskText = document.getElementById("taskName"); 
        taskText.innerHTML = taskNames[currentTask];
      }

      // Calculate hours, minutes and seconds
      var hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
      var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
      var seconds = Math.floor((distance % (1000 * 60)) / 1000);

      // Display the result to screen
      document.getElementById("counter").innerHTML = hours + ":"
        + minutes + ":" + seconds;

      // Notify user if countdown complete
      if (distance < 0) {
        clearInterval(timerInterval);
        document.getElementById("counter").innerHTML = "00:00:00";
        taskText.innerHTML = "COMPLETE";

      }
    }

    function addTask()
    {
      numSubTasks++;
            
      // Retrieve the container tot add sub-tasks to
      var tasksContainer = document.getElementById("tasksContainer");
      
      // Create two input elements
      var taskNameInput = document.createElement("input");
      var mInput = document.createElement("input");

      //Set type, placeholder and id of taskNameInput
      taskNameInput.type = "Text";
      taskNameInput.placeholder = "Task name";
      taskNameInput.id = "taskName" + (numSubTasks.toString(10)-1);

      //Set type, placeholder and id of timer
      mInput.type = "number";
      mInput.placeholder = "Minutes";
      mInput.id = "taskTime" + (numSubTasks.toString(10)-1);

      tasksContainer.appendChild(taskNameInput);
      tasksContainer.appendChild(mInput);
      
      // Append a line break 
      tasksContainer.appendChild(document.createElement("br")); 
    }

    function importSubTask() {

    }

    function exportSubTask() {

    }

    function pauseSubTask() {

    }

  </script>
</head>

<body>
  <h1>Meeting timer</h1>
  <p id="counter"></p>
  <p id="taskName"></p>
  <div id="tasksContainer" class="center_div">
    <input type="text" placeholder="Task name" id="taskName0">
    <input type="number" placeholder="Minutes" id="taskTime0"><br>
  </div>
    <button type="button" onclick="addTask()">Add Task</button>
  </div>
  <div class="center_div">
    <form>
      <button type="button" onclick="initiateCountdown()">Start</button>
      <button type="button" onclick="pauseCountdown()">Pause</button>
      <button type="button" onclick="resetCountdown()">Reset</button>
    </form>
  </div>
</body>

</html>